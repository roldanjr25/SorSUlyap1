<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Class Schedules</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  
  <!--Header Icons-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Main JS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <script src="config.js"></script>

  
</head>

<body class="courses-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
        <div class="logo">SorSUlyap</div>
        <nav class="nav">
          <a href="index.html" class="active">Home</a>
          <a href="calendar.html">Calendar of Activities</a>
          <a href="classSched.html">Class Schedules</a>
          <a href="offline.html">Offline Mode</a>
          <a href="customer.html">Customer Service</a>
        </nav>
        <div class="header-right">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search">
            </div>
            <button class="icon-button">
                <i class="fas fa-bell"></i>
            </button>
            <button class="icon-button">
                <i class="fas fa-user"></i>
            </button>
        </div>
    </header>


  <main class="main">
      <!-- Main Content - Grid View -->
    <div id="gridView" class="container">
        <div class="header-container">
            <div class="header-icon">üìã</div>
            <div class="header-text">
                <h1>Class Schedule</h1>
            </div>
        </div>

        <div class="schedule-grid">
            <!-- Computer Science - 1st Year Block 1 -->
            <div class="schedule-card">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='%23666'%3EComputer Science - 1st Year Block 1%3C/text%3E%3C/svg%3E" 
                     alt="Computer Science Schedule" 
                     class="schedule-image"
                     onclick="showDetail('Computer Science - 1st Year Block 1')">
                <div class="schedule-title">Computer Science - 1st Year Block 1</div>
                <div class="schedule-subtitle">Computer Science</div>
                <div class="button-group">
                    <button class="btn btn-view" onclick="showDetail('Computer Science - 1st Year Block 1')">View</button>
                    <button class="btn btn-download">Download</button>
                </div>
            </div>

            <!-- Computer Science - 2nd Year Block 1 -->
            <div class="schedule-card">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='%23666'%3EComputer Science - 2nd Year Block 1%3C/text%3E%3C/svg%3E" 
                     alt="Computer Science Schedule" 
                     class="schedule-image"
                     onclick="showDetail('Computer Science - 2nd Year Block 1')">
                <div class="schedule-title">Computer Science - 2nd Year Block 1</div>
                <div class="schedule-subtitle">Computer Science</div>
                <div class="button-group">
                    <button class="btn btn-view" onclick="showDetail('Computer Science - 2nd Year Block 1')">View</button>
                    <button class="btn btn-download">Download</button>
                </div>
            </div>

            <!-- Information Technology - 1st Year Block 1 -->
            <div class="schedule-card">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='%23666'%3EInformation Technology - 1st Year Block 1%3C/text%3E%3C/svg%3E" 
                     alt="Information Technology Schedule" 
                     class="schedule-image"
                     onclick="showDetail('Information Technology - 1st Year Block 1')">
                <div class="schedule-title">Information Technology - 1st Year Block 1</div>
                <div class="schedule-subtitle">Information Technology</div>
                <div class="button-group">
                    <button class="btn btn-view" onclick="showDetail('Information Technology - 1st Year Block 1')">View</button>
                    <button class="btn btn-download">Download</button>
                </div>
            </div>

            <!-- Information Technology - 1st Year Block 1 (duplicate) -->
            <div class="schedule-card">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='%23666'%3EInformation Technology - 1st Year Block 1%3C/text%3E%3C/svg%3E" 
                     alt="Information Technology Schedule" 
                     class="schedule-image"
                     onclick="showDetail('Information Technology - 1st Year Block 1')">
                <div class="schedule-title">Information Technology - 1st Year Block 1</div>
                <div class="schedule-subtitle">Information Technology</div>
                <div class="button-group">
                    <button class="btn btn-view" onclick="showDetail('Information Technology - 1st Year Block 1')">View</button>
                    <button class="btn btn-download">Download</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail View -->
    <div id="detailView" class="detail-view">
        <button class="back-btn" onclick="showGrid()">‚Üê Back</button>
        
        <div class="detail-header">
            <div class="header-icon">üìã</div>
            <div class="header-text">
                <h1>Class Schedule</h1>
                <div id="detailTitle" class="schedule-subtitle"></div>
            </div>
        </div>

        <div class="detail-image-container">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='400'%3E%3Crect width='600' height='400' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='18' fill='%23666'%3EDetailed Schedule View%3C/text%3E%3C/svg%3E" 
                 alt="Detailed Schedule" 
                 class="detail-image">
        </div>

        <div class="download-btn-container">
            <button class="download-btn">
                ‚¨á Download Schedule
            </button>
        </div>
    </div>

    <script>
        // Load schedules from API
        async function loadSchedules() {
            const scheduleGrid = document.querySelector('.schedule-grid');
            const token = localStorage.getItem(CONFIG?.TOKEN_KEY || 'token');

            try {
                console.log('Loading schedules from API...');
                const response = await fetch(CONFIG.ENDPOINTS.SCHEDULES, {
                    headers: token ? {
                        'Authorization': `Bearer ${token}`
                    } : {}
                });

                const data = await response.json();
                console.log('Schedules API response:', data);

                if (data.success && Array.isArray(data.data) && data.data.length > 0) {
                    // Clear static cards and add dynamic ones
                    scheduleGrid.innerHTML = '';
                    data.data.forEach(schedule => {
                        const scheduleCard = createScheduleCard(schedule);
                        scheduleGrid.appendChild(scheduleCard);
                    });
                    console.log('Loaded', data.data.length, 'schedules from database');
                } else {
                    console.log('No schedules found, showing sample schedules');
                    // Show a message or keep some static ones if no schedules exist
                    addNoSchedulesMessage(scheduleGrid);
                }
            } catch (error) {
                console.error('Failed to load schedules:', error);
                // On error, show sample schedules
                console.log('Error loading schedules, showing sample schedules');
            }
        }

        function createScheduleCard(schedule) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'schedule-card';

            // Check if the uploaded file is an image
            const isImage = schedule.File_Name && /\.(jpe?g|png|gif|bmp|webp)$/i.test(schedule.File_Name);
            let imageSrc;

            if (isImage && schedule.File_Path) {
                // Extract just the filename (File_Path contains 'uploads\\filename.jpg')
                const fileName = schedule.File_Path.split(/[/\\]/).pop(); // Get last part after split
                imageSrc = '/uploads/' + fileName;
                console.log('Using uploaded image:', imageSrc, 'from:', schedule.File_Path);
            } else {
                // Generate SVG placeholder for non-image files (PDF, Word, etc.)
                const svgText = encodeURIComponent(`
                    <svg xmlns='http://www.w3.org/2000/svg' width='400' height='300'>
                        <rect width='400' height='300' fill='#f0f0f0'/>
                        <text x='50%' y='35%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='14' fill='#666'>üìÑ</text>
                        <text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='12' fill='#666'>${schedule.Title}</text>
                        <text x='50%' y='75%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='10' fill='#999'>${getFileExtension(schedule.File_Name) || 'File'}</text>
                    </svg>
                `);
                imageSrc = `data:image/svg+xml,${svgText}`;
            }

            cardDiv.innerHTML = `
                <img src="${imageSrc}"
                     alt="${schedule.Title}"
                     class="schedule-image"
                     onclick="showDetail('${schedule.Title}')"
                     onerror="handleImageError(this)"
                     onload="console.log('Image loaded successfully:', '${imageSrc}')">
                <div class="schedule-title">${schedule.Title}</div>
                <div class="schedule-subtitle">${getProgramDisplayName(schedule.Program)} ${getYearDisplay(schedule.YearLevel)}${schedule.Section ? ' - ' + schedule.Section : ''}</div>
                <div class="button-group">
                    <button class="btn btn-view" onclick="showDetail('${schedule.Title}')">View</button>
                    <button class="btn btn-download" onclick="downloadSchedule('${schedule.File_Path}', '${schedule.File_Name}')">Download</button>
                </div>
            `;

            return cardDiv;
        }

        function getFileExtension(filename) {
            return filename ? filename.split('.').pop().toUpperCase() : 'FILE';
        }

        function handleImageError(img) {
            // Fallback to SVG if image fails to load
            const svgText = encodeURIComponent(`
                <svg xmlns='http://www.w3.org/2000/svg' width='400' height='300'>
                    <rect width='400' height='300' fill='#f0f0f0'/>
                    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='14' fill='#666'>üìÑ File</text>
                </svg>
            `);
            img.src = `data:image/svg+xml,${svgText}`;
        }

        function getProgramDisplayName(program) {
            const programNames = {
                'ITE': 'Information Technology Education',
                'BTVRM': 'Business Technology Vocational Rizal Memorial',
                'ABA': 'Applied Business Administration',
                'Educ': 'Education'
            };
            return programNames[program] || program || 'General Department';
        }

        function getYearDisplay(yearLevel) {
            if (!yearLevel) return '';
            if (yearLevel === '1') return '1st Year';
            if (yearLevel === '2') return '2nd Year';
            if (yearLevel === '3') return '3rd Year';
            if (yearLevel === '4') return '4th Year';
            return yearLevel;
        }

        function downloadSchedule(filePath, fileName) {
            if (filePath && fileName) {
                // Extract just the filename from the file path
                const actualFileName = filePath.split(/[/\\]/).pop();
                // Create a temporary link to download the file
                const link = document.createElement('a');
                link.href = '/uploads/' + actualFileName;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert('File not available for download');
            }
        }

        function addNoSchedulesMessage(container) {
            if (container.querySelectorAll('.schedule-card').length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #666;">
                        <i class="fas fa-calendar-alt" style="font-size: 3em; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>No Schedules Available</h3>
                        <p>Schedules will appear here once faculty upload them.</p>
                    </div>
                `;
            }
        }

        function showDetail(title) {
            document.getElementById('gridView').style.display = 'none';
            document.getElementById('detailView').classList.add('active');
            document.getElementById('detailTitle').textContent = title;
            window.scrollTo(0, 0);
        }

        function showGrid() {
            document.getElementById('gridView').style.display = 'block';
            document.getElementById('detailView').classList.remove('active');
            window.scrollTo(0, 0);
        }

        // Load schedules when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadSchedules();
        });
    </script>


   


  </main>
   

  

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="profilepopup.js"></script>

</body>

</html>
