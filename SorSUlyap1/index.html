<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>SorSUlyap</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">


  <!--Header Icons-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<body>

  <header id="header" class="header d-flex align-items-center sticky-top">
        <div class="logo">SorSUlyap</div>
        <nav class="nav">
          <a href="index.html" class="active">Home</a>
          <a href="calendar.html">Calendar of Activities</a>
          <a href="classSched.html">Class Schedules</a>
          <a href="offline.html">Offline Mode</a>
          <a href="customer.html">Customer Service</a>
        </nav>
        <div class="header-right">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search">
            </div>
            <div class="notification-container">
                <button class="icon-button notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                </button>
                <div class="notification-dropdown" id="notification-dropdown" style="display: none;">
                    <div class="notification-header">
                        <h4>Notifications</h4>
                        <button class="close-btn" id="close-notification">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="notification-section">
                        <div class="section-label">Recent</div>
                        <div class="notification-list" id="notification-list">
                            <!-- Notifications will be populated here -->
                        </div>
                    </div>
                    <div class="notification-footer">
                        <a href="notifications.html" class="see-all-link">See all Notifications</a>
                        <button class="mark-all-read-btn" id="mark-all-read">Mark all as read</button>
                    </div>
                </div>
            </div>
            <button type="button" class="icon-button" id="logoutBtn">
                <i class="fas fa-user"></i>
            </button>


        </div>
    </header>

    


     <!-- Main Content -->
    <main class="main-content">
        <!-- Welcome Section Anchor -->
        <div id="welcome"></div>

        <div class="announcement-card">
            <div class="admin-header">
                <div class="admin-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="admin-info">
                    <h3>Admin</h3>
                    <p>Administrator</p>
                </div>
            </div>

            <div class="card-content">
                <h2 class="welcome-title">Welcome to SorSUlyap!</h2>
                <p class="welcome-text">
                    SorSUlyap is a centralized university system for announcements, featuring integrated scheduling and calendar capabilities. The SorSUlyap system serves as a secure and exclusive hub, accessible only through SorSu Email. This system enhances communication, improves transparency, and provides an easy way to stay notified and avoid confusion.
                </p>

                <div class="attachments-section">
                    <div class="attachments-title">
                        <i class="fas fa-download"></i>
                        Attachments
                    </div>
                    <div class="attachment-item">
                        <div class="attachment-info">
                            <i class="fas fa-file-pdf attachment-icon"></i>
                            <span class="attachment-name">Announcement1.pdf</span>
                        </div>
                        <button class="download-btn">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                    </div>
                </div>

                <div class="announcement-illustration">
                    <i class="fas fa-bullhorn"></i>
                </div>
            </div>
        </div>

        <div class="announcement-card">
            <div class="admin-header">
                <div class="admin-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="admin-info">
                    <h3>Admin</h3>
                    <p>Administrator</p>
                </div>
            </div>

            <div class="card-content">
                <h2 class="welcome-title">Welcome to SorSUlyap!</h2>
                <p class="welcome-text">
                    SorSUlyap is a centralized university system for announcements, featuring integrated scheduling and calendar capabilities. The SorSUlyap system serves as a secure and exclusive hub, accessible only through SorSu Email. This system enhances communication, improves transparency, and provides an easy way to stay notified and avoid confusion.
                </p>

                <div class="attachments-section">
                    <div class="attachments-title">
                        <i class="fas fa-download"></i>
                        Attachments
                    </div>
                    <div class="attachment-item">
                        <div class="attachment-info">
                            <i class="fas fa-file-pdf attachment-icon"></i>
                            <span class="attachment-name">Announcement1.pdf</span>
                        </div>
                        <button class="download-btn">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                    </div>
                </div>

                <div class="announcement-illustration">
                    <i class="fas fa-bullhorn"></i>
                </div>
            </div>
        </div>

        <div class="announcement-card">
            <div class="admin-header">
                <div class="admin-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="admin-info">
                    <h3>Admin</h3>
                    <p>Administrator</p>
                </div>
            </div>

            <div class="card-content">
                <h2 class="welcome-title">Welcome to SorSUlyap!</h2>
                <p class="welcome-text">
                    SorSUlyap is a centralized university system for announcements, featuring integrated scheduling and calendar capabilities. The SorSUlyap system serves as a secure and exclusive hub, accessible only through SorSu Email. This system enhances communication, improves transparency, and provides an easy way to stay notified and avoid confusion.
                </p>

                <div class="attachments-section">
                    <div class="attachments-title">
                        <i class="fas fa-download"></i>
                        Attachments
                    </div>
                    <div class="attachment-item">
                        <div class="attachment-info">
                            <i class="fas fa-file-pdf attachment-icon"></i>
                            <span class="attachment-name">Announcement1.pdf</span>
                        </div>
                        <button class="download-btn">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                    </div>
                </div>

                <div class="announcement-illustration">
                    <i class="fas fa-bullhorn"></i>
                </div>
            </div>
        </div>
    </main>


  

  
  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <script src="profilepopup.js"></script>

  <script src="logout_popup.js"></script>

  <!-- Test notification functionality -->
  <script src="config.js"></script>
  <script src="api.js"></script>

  <script>
    // Load announcements dynamically
    async function loadAnnouncements() {
      const token = localStorage.getItem(CONFIG.TOKEN_KEY);
      if (!token) {
        // If not logged in, keep the static welcome announcements
        return;
      }

      try {
        const announcements = await api.getAnnouncements();
        if (announcements.success) {
          displayAnnouncements(announcements.data);
        }
      } catch (error) {
        console.error('Failed to load announcements:', error);
        // Keep static announcements on error
      }
    }

    function displayAnnouncements(announcements) {
      const mainContent = document.querySelector('.main-content');

      // Remove the static welcome section if it exists
      const welcomeDiv = mainContent.querySelector('#welcome');
      if (welcomeDiv) {
        welcomeDiv.remove();
      }

      // Clear existing static announcement cards
      const staticCards = mainContent.querySelectorAll('.announcement-card');
      staticCards.forEach(card => card.remove());

      // Create dynamic announcement cards
      announcements.forEach(announcement => {
        const announcementCard = document.createElement('div');
        announcementCard.className = 'announcement-card';

        const attachmentsHTML = announcement.attachments && announcement.attachments.length > 0
          ? `
            <div class="attachments-section">
              <div class="attachments-title">
                <i class="fas fa-download"></i>
                Attachments
              </div>
              ${announcement.attachments.map(attachment => `
                <div class="attachment-item">
                  <div class="attachment-info">
                    <i class="fas fa-file-pdf attachment-icon"></i>
                    <span class="attachment-name">${attachment.File_Name}</span>
                  </div>
                  <button class="download-btn" onclick="downloadAttachment('${attachment.File_Path}')">
                    <i class="fas fa-download"></i>
                    Download
                  </button>
                </div>
              `).join('')}
            </div>
          `
          : '';

        announcementCard.innerHTML = `
          <div class="admin-header">
            <div class="admin-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="admin-info">
              <h3>${announcement.Posted_by_Name || 'Admin'}</h3>
              <p>Administrator</p>
            </div>
          </div>

          <div class="card-content">
            <h2 class="welcome-title">${announcement.Title || 'Announcement'}</h2>
            <p class="welcome-text">${announcement.Content}</p>

            ${attachmentsHTML}

            <div class="announcement-illustration">
              <i class="fas fa-bullhorn"></i>
            </div>

            <div class="announcement-meta">
              <small class="text-muted">
                Posted: ${new Date(announcement.Date_Posted).toLocaleDateString()}
              </small>
            </div>
          </div>
        `;

        mainContent.appendChild(announcementCard);
      });

      // Create notifications for new announcements
      createNotificationsFromAnnouncements(announcements);
    }

    function createNotificationsFromAnnouncements(announcements) {
      // Only create notifications if we have access to notification functions
      if (!window.cryptoRandom || !window.renderNotifications) return;

      const LS_KEY = 'cs_notifs';
      const currentNotifs = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

      announcements.forEach(announcement => {
        // Check if notification already exists for this announcement (by title)
        const existingNotif = currentNotifs.find(n => n.title === announcement.Title);

        if (!existingNotif) {
          // Create new notification
          const notifs = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

          // Create a unique ID for the notification
          const notifId = window.cryptoRandom
            ? window.cryptoRandom()
            : Math.random().toString(16).slice(2) + Date.now().toString(16);

          notifs.unshift({
            id: notifId,
            title: announcement.Title || 'New Announcement',
            message: (announcement.Content || 'Please check the new announcement.').substring(0, 120) +
                     (announcement.Content && announcement.Content.length > 120 ? '...' : ''),
            timestamp: new Date(announcement.Date_Posted).getTime() || Date.now(),
            read: false,
            sender: announcement.Posted_by_Name || 'Admin',
            link: 'index.html'
          });

          localStorage.setItem(LS_KEY, JSON.stringify(notifs));

          console.log('Created notification for announcement:', announcement.Title);
        }
      });

      // Update notification display after adding new ones
      if (window.renderNotifications) {
        window.renderNotifications();
      }
    }

    function downloadAttachment(filePath) {
      // Create a temporary link to download the file
      const link = document.createElement('a');
      link.href = '/uploads/' + filePath; // Adjust path as needed
      link.download = filePath;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Add a test notification button for demo
    document.addEventListener('DOMContentLoaded', function() {
      loadAnnouncements(); // Load dynamic announcements

      setTimeout(() => {
        const existingBtn = document.querySelector('#test-notification-btn');
        if (!existingBtn) {
          const testBtn = document.createElement('button');
          testBtn.id = 'test-notification-btn';
          testBtn.textContent = 'Add Test Notification';
          Object.assign(testBtn.style, {
            position: 'fixed',
            bottom: '20px',
            right: '20px',
            background: '#e8a5a5',
            color: 'white',
            border: 'none',
            padding: '10px 15px',
            borderRadius: '5px',
            cursor: 'pointer',
            zIndex: '10000',
            fontSize: '12px'
          });
          document.body.appendChild(testBtn);

          testBtn.addEventListener('click', function() {
            // This will call the notification system functions if they exist
            if (window.addTestNotification) {
              window.addTestNotification();
            }
          });
        }
      }, 2000);
    });
  </script>


</body>

</html>
