<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - SorSUlyap</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="assets/css/main.css" rel="stylesheet">
</head>
<body>

    <header id="header" class="header d-flex align-items-center sticky-top">
        <div class="logo">SorSUlyap</div>
        <nav class="nav">
          <a href="index.html">Home</a>
          <a href="calendar.html">Calendar of Activities</a>
          <a href="classSched.html">Class Schedules</a>
          <a href="offline.html">Offline Mode</a>
          <a href="customer.html">Customer Service</a>
        </nav>
        <div class="header-right">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search">
            </div>
            <div class="notification-container">
                <button class="icon-button notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                </button>
                <div class="notification-dropdown" id="notification-dropdown" style="display: none;">
                    <div class="notification-header">
                        <h4>Notifications</h4>
                        <button class="close-btn" id="close-notification">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="notification-section">
                        <div class="section-label">Recent</div>
                        <div class="notification-list" id="notification-list">
                            <!-- Notifications will be populated here -->
                        </div>
                    </div>
                    <div class="notification-footer">
                        <a href="notifications.html" class="see-all-link">See all Notifications</a>
                        <button class="mark-all-read-btn" id="mark-all-read">Mark all as read</button>
                    </div>
                </div>
            </div>
            <button type="button" class="icon-button" id="logoutBtn">
                <i class="fas fa-user"></i>
            </button>
        </div>
    </header>

    <main class="main-content">
        <div class="notification-page">
            <!-- Top Header Section -->
            <div class="page-header">
                <div class="header-back-icon" onclick="window.location.href='index.html'">
                    <i class="fa-solid fa-arrow-left"></i>
                </div>

                <div class="page-title-section">
                    <div class="page-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="page-title">Notifications</div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="filter-controls">
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All Notifications</button>
                    <button class="filter-tab" data-filter="unread">Unread</button>
                    <button class="filter-tab" data-filter="read">Read</button>
                </div>

                <button class="mark-all-btn" id="mark-all-read-page">Mark All as Read</button>
            </div>

            <!-- Notification Stats -->
            <div class="stats-section">
                <div class="stat-item">
                    <div class="stat-number" id="total-count">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="unread-count">0</div>
                    <div class="stat-label">Unread</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="read-count">0</div>
                    <div class="stat-label">Read</div>
                </div>
            </div>

            <!-- Notifications List -->
            <div class="notifications-container" id="full-notification-list">
                <!-- Notifications will be dynamically loaded here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="empty-state" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-bell-slash"></i>
                </div>
                <h3>No notifications yet</h3>
                <p>You'll see notifications about important updates, announcements, and activities here.</p>
            </div>
        </div>
    </main>

    <script>
        // Copy the notification system code from main.js
        const notificationBell = document.querySelector('.notification-bell');
        const notificationDropdown = document.getElementById('notification-dropdown');
        const notificationBadge = document.getElementById('notification-badge');
        const notificationList = document.getElementById('notification-list');
        const closeNotification = document.getElementById('close-notification');
        const markAllRead = document.getElementById('mark-all-read');
        const markAllReadPage = document.getElementById('mark-all-read-page');

        // Full page elements
        const fullNotificationList = document.getElementById('full-notification-list');
        const filterTabs = document.querySelectorAll('.filter-tab');
        const totalCount = document.getElementById('total-count');
        const unreadCount = document.getElementById('unread-count');
        const readCount = document.getElementById('read-count');
        const emptyState = document.getElementById('empty-state');

        let currentFilter = 'all';

        if (notificationBell && notificationDropdown) {
            // LocalStorage key
            const LS_KEYS = {
                notifs: 'cs_notifs'
            };

            // Seed data if empty
            function seedIfEmpty() {
                if (!localStorage.getItem(LS_KEYS.notifs)) {
                    const now = Date.now();
                    const seedNotifs = [
                        {
                            id: cryptoRandom(),
                            title: 'Welcome to SorSUlyap',
                            message: 'Stay updated with your schedules and announcements.',
                            timestamp: now - 86400000,
                            read: false,
                            sender: 'Admin'
                        },
                        {
                            id: cryptoRandom(),
                            title: 'System Maintenance',
                            message: 'Scheduled maintenance this weekend from 2 AM to 4 AM.',
                            timestamp: now - 3600000,
                            read: false,
                            sender: 'Admin'
                        },
                        {
                            id: cryptoRandom(),
                            title: 'New Course Available',
                            message: 'Introduction to Computer Science is now open for enrollment.',
                            timestamp: now - 7200000,
                            read: true,
                            sender: 'Academic Office'
                        },
                        {
                            id: cryptoRandom(),
                            title: 'Exam Schedule Updated',
                            message: 'Mid-term examination schedule has been revised. Please check your student portal.',
                            timestamp: now - 172800000,
                            read: true,
                            sender: 'Examination Office'
                        },
                        {
                            id: cryptoRandom(),
                            title: 'Campus Event: Career Fair',
                            message: 'Join us for the Annual Career Fair on Friday, December 15th at the University Gymnasium.',
                            timestamp: now - 259200000,
                            read: false,
                            sender: 'Student Affairs'
                        }
                    ];
                    localStorage.setItem(LS_KEYS.notifs, JSON.stringify(seedNotifs));
                }
            }

            function cryptoRandom() {
                try { return crypto.getRandomValues(new Uint32Array(1))[0].toString(16) + Date.now().toString(16); }
                catch { return Math.random().toString(16).slice(2) + Date.now().toString(16); }
            }

            // Helpers to load/save
            const load = (k) => JSON.parse(localStorage.getItem(k) || '[]');
            const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

            // Format timestamp
            function formatTimestamp(ts) {
                const now = Date.now();
                const diff = now - ts;
                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));

                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes}m ago`;
                if (hours < 24) return `${hours}h ago`;
                if (days < 7) return `${days}d ago`;

                // For older dates, show actual date
                const date = new Date(ts);
                return date.toLocaleDateString();
            }

            // Escape HTML
            function escapeHtml(s) { return (s||'').replace(/[&<>]/g, c=>({"&":"&","<":"<",">":">"}[c])); }

            // Calculate stats
            function updateStats(notifications) {
                const total = notifications.length;
                const unread = notifications.filter(n => !n.read).length;
                const read = total - unread;

                totalCount.textContent = total;
                unreadCount.textContent = unread;
                readCount.textContent = read;
            }

            // Render notifications (dropdown version)
            function renderNotifications() {
                const notifs = load(LS_KEYS.notifs);
                const unreadCount = notifs.filter(n => !n.read).length;

                // Update badge
                if (unreadCount > 0) {
                    notificationBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    notificationBadge.style.display = 'flex';
                } else {
                    notificationBadge.style.display = 'none';
                }

                // Render notification list for dropdown
                if (notificationList) {
                    if (notifs.length === 0) {
                        notificationList.innerHTML = `
                            <div class="notification-empty">
                                <i class="fas fa-bell-slash"></i>
                                <p>No notifications yet</p>
                            </div>
                        `;
                        return;
                    }

                    const recentNotifs = notifs
                        .sort((a, b) => b.timestamp - a.timestamp)
                        .slice(0, 10);

                    notificationList.innerHTML = recentNotifs.map(n => `
                        <div class="notification-card ${n.read ? '' : 'unread'}" data-id="${n.id}">
                            <div class="notification-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-sender">${escapeHtml(n.sender)}</div>
                                <div class="notification-title">${escapeHtml(n.title)}</div>
                                <div class="notification-message">${escapeHtml(n.message)}</div>
                                <div class="notification-timestamp">${formatTimestamp(n.timestamp)}</div>
                            </div>
                            <button class="dismiss-btn" data-action="dismiss" data-id="${n.id}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `).join('');
                }
            }

            // Render full page notifications
            function renderFullPageNotifications(filter = 'all') {
                const notifs = load(LS_KEYS.notifs);
                currentFilter = filter;

                if (fullNotificationList && totalCount) {
                    let filteredNotifs;

                    switch (filter) {
                        case 'unread':
                            filteredNotifs = notifs.filter(n => !n.read);
                            break;
                        case 'read':
                            filteredNotifs = notifs.filter(n => n.read);
                            break;
                        default:
                            filteredNotifs = notifs;
                    }

                    updateStats(notifs);

                    if (filteredNotifs.length === 0) {
                        fullNotificationList.innerHTML = '';
                        emptyState.style.display = 'block';
                        return;
                    }

                    emptyState.style.display = 'none';

                    fullNotificationList.innerHTML = filteredNotifs
                        .sort((a, b) => b.timestamp - a.timestamp)
                        .map(n => `
                            <div class="full-notification-card ${n.read ? 'read' : 'unread'}" data-id="${n.id}">
                                <div class="notification-icon">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div class="notification-details">
                                    <div class="notification-meta">
                                        <div class="notification-sender">${escapeHtml(n.sender)}</div>
                                        <div class="notification-time">${formatTimestamp(n.timestamp)}</div>
                                    </div>
                                    <h4 class="notification-title">${escapeHtml(n.title)}</h4>
                                    <p class="notification-message">${escapeHtml(n.message)}</p>
                                </div>
                                <div class="notification-actions">
                                    ${!n.read ? `<button class="mark-read-btn" data-action="mark-read" data-id="${n.id}">Mark as Read</button>` : ''}
                                    <button class="delete-btn" data-action="delete" data-id="${n.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                ${!n.read ? '<div class="unread-indicator"></div>' : ''}
                            </div>
                        `).join('');
                }
            }

            // Toggle notification dropdown
            function toggleNotificationDropdown() {
                const isVisible = notificationDropdown.style.display === 'block';
                if (isVisible) {
                    notificationDropdown.style.display = 'none';
                } else {
                    renderNotifications();
                    notificationDropdown.style.display = 'block';
                    setTimeout(() => notificationDropdown.style.opacity = '1', 10);
                }
            }

            // Close notification dropdown
            function closeNotificationDropdown() {
                notificationDropdown.style.display = 'none';
                notificationDropdown.style.opacity = '0';
            }

            // Mark notification as read
            function markAsRead(notificationId) {
                const notifs = load(LS_KEYS.notifs);
                const notif = notifs.find(n => n.id === notificationId);
                if (notif && !notif.read) {
                    notif.read = true;
                    save(LS_KEYS.notifs, notifs);
                    renderNotifications();
                    renderFullPageNotifications(currentFilter);
                }
            }

            // Delete notification
            function deleteNotification(notificationId) {
                const notifs = load(LS_KEYS.notifs);
                const updatedNotifs = notifs.filter(n => n.id !== notificationId);
                save(LS_KEYS.notifs, updatedNotifs);
                renderNotifications();
                renderFullPageNotifications(currentFilter);
            }

            // Dismiss notification
            function dismissNotification(notificationId) {
                deleteNotification(notificationId);
            }

            // Mark all notifications as read
            function markAllAsRead() {
                const notifs = load(LS_KEYS.notifs);
                notifs.forEach(n => n.read = true);
                save(LS_KEYS.notifs, notifs);
                renderNotifications();
                renderFullPageNotifications(currentFilter);
            }

            // Event listeners for dropdown
            if (notificationBell) {
                notificationBell.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleNotificationDropdown();
                });
            }

            if (closeNotification) {
                closeNotification.addEventListener('click', closeNotificationDropdown);
            }

            if (markAllRead) {
                markAllRead.addEventListener('click', markAllAsRead);
            }

            if (markAllReadPage) {
                markAllReadPage.addEventListener('click', markAllAsRead);
            }

            // Filter tabs
            filterTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    filterTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    renderFullPageNotifications(tab.getAttribute('data-filter'));
                });
            });

            // Click outside to close
            document.addEventListener('click', (e) => {
                if (!notificationBell.contains(e.target) && !notificationDropdown.contains(e.target)) {
                    closeNotificationDropdown();
                }
            });

            // Handle notification card interactions (dropdown)
            if (notificationList) {
                notificationList.addEventListener('click', (e) => {
                    const card = e.target.closest('.notification-card');
                    const dismissBtn = e.target.closest('.dismiss-btn');

                    if (dismissBtn) {
                        e.stopPropagation();
                        const notificationId = dismissBtn.getAttribute('data-id');
                        dismissNotification(notificationId);
                    } else if (card) {
                        const notificationId = card.getAttribute('data-id');
                        markAsRead(notificationId);
                        // Optionally navigate to full notifications page
                        // window.location.href = 'notifications.html';
                    }
                });
            }

            // Handle full page notification interactions
            if (fullNotificationList) {
                fullNotificationList.addEventListener('click', (e) => {
                    const markReadBtn = e.target.closest('.mark-read-btn');
                    const deleteBtn = e.target.closest('.delete-btn');
                    const notificationId = e.target.closest('.full-notification-card')?.getAttribute('data-id');

                    if (markReadBtn && notificationId) {
                        e.stopPropagation();
                        markAsRead(notificationId);
                    } else if (deleteBtn && notificationId) {
                        e.stopPropagation();
                        deleteNotification(notificationId);
                    }
                });
            }

            // Prevent propagation on dropdown clicks
            if (notificationDropdown) {
                notificationDropdown.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }

            // Initialize
            seedIfEmpty();
            renderNotifications();

            // This page has full notification view, so render that too
            if (fullNotificationList) {
                renderFullPageNotifications('all');
            }
        }
    </script>

    <!-- Logout functionality -->
    <script src="logout_popup.js"></script>

    <style>
        /* Page Header */
        .notification-page {
            background-color: #ffffff;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .page-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .header-back-icon {
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }

        .header-back-icon:hover {
            color: #374151;
        }

        .page-title-section {
            display: flex;
            gap: 15px;
        }

        .page-icon {
            font-size: 32px;
            color: #e8a5a5;
            background-color: rgba(232, 165, 165, 0.1);
            padding: 12px;
            border-radius: 12px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #222;
            align-self: center;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
        }

        .filter-tab {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #6b7280;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-tab:hover {
            border-color: #e8a5a5;
            color: #e8a5a5;
        }

        .filter-tab.active {
            border-color: #e8a5a5;
            background-color: #e8a5a5;
            color: white;
        }

        .mark-all-btn {
            background-color: #e8a5a5;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .mark-all-btn:hover {
            background-color: #d68b8b;
        }

        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9fafb;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #e8a5a5;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        /* Full Notification Cards */
        .notifications-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .full-notification-card {
            background-color: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            gap: 16px;
            align-items: flex-start;
            transition: all 0.2s ease;
            position: relative;
        }

        .full-notification-card:hover {
            border-color: #e8a5a5;
            box-shadow: 0 4px 12px rgba(232, 165, 165, 0.15);
        }

        .full-notification-card.unread {
            border-left: 4px solid #dc3545;
        }

        .full-notification-card.unread .unread-indicator {
            position: absolute;
            top: 20px;
            left: 16px;
            width: 10px;
            height: 10px;
            background-color: #dc3545;
            border-radius: 50%;
        }

        .notification-icon {
            width: 48px;
            height: 48px;
            background-color: #fecaca;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e8a5a5;
            font-size: 20px;
            flex-shrink: 0;
        }

        .notification-details {
            flex: 1;
        }

        .notification-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .notification-sender {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        .notification-time {
            font-size: 12px;
            color: #9ca3af;
        }

        .notification-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .notification-message {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .mark-read-btn {
            background-color: #e8a5a5;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .mark-read-btn:hover {
            background-color: #d68b8b;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .delete-btn:hover {
            background-color: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            color: #e5e7eb;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 20px;
            color: #374151;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: #6b7280;
            line-height: 1.5;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .notification-page {
                margin: 10px;
                padding: 20px;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .full-notification-card {
                flex-direction: column;
                gap: 12px;
            }

            .notification-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .notification-actions {
                align-self: flex-end;
            }
        }
    </style>

</body>
</html>
